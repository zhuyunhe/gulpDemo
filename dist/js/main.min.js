function login(){var t=navigator.userAgent;t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.location.href="ios://login":t.indexOf("Android")>-1||t.indexOf("Linux")>-1?window.stub.jsMethod("login"):alert("请下载“好家长”客户端登录")}function getCoin(){var t=navigator.userAgent;t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.location.href="ios://getcoin":t.indexOf("Android")>-1||t.indexOf("Linux")>-1?window.stub.jsMethod("getcoin"):alert("请下载“好家长”客户端赚金币")}function showMyOrder(){window.location.href="/share/index/myOrder.html"}function isEmptyObj(t){for(var a in t)return!1;return!0}function getSearch(){for(var t,a,e,i=window.location.search.substring(1),o={},n=i.split("&"),r=0;r<n.length;r++)t=n[r].indexOf("="),t!==-1&&(a=n[r].substring(0,t),e=n[r].substring(t+1),o[a]=decodeURI(e));return o}function ajaxInfo(){$.ajax({url:"/task/user_info.json",type:"get",dataType:"json",data:{uid:uid},success:function(t){cookData(t)},error:function(t){}})}function cookData(t){if("fail"!=t.status){var a=JSON.stringify(t);sessionStorage.setItem("userData",a);var e=t.user,i=t.gift,o=[10,15,20,25,30,30,35];if(!isEmptyObj(e)){var n,r=e.nickname,s=e.study_day,c=parseInt(e.signed_day),l=e.right_number,d=Math.ceil(l/s),g=c>7?7:c;switch(!0){case 1===c:d=5;break;case 2===c:d=10;break;case 3===c:d=15;break;case 4===c:d=20;break;case 5===c:d=25;break;case 6===c:d=30;break;case c>6:d=35}var m=sessionStorage.getItem("exchangeDone");n=1==m?localStorage.getItem("coinNum"):e.coin_num,localStorage.setItem("coinNum",n),localStorage.setItem("uid",uid),localStorage.setItem("nickName",r);var u=new CountUp("signedDay",0,c);if(u.start(),$("#studyDay").text(s),$("#advanceScore").text(d?d:0),$("#rightNum").text(l),$("#coinNum").text(n),$("#todayCoin").text(o[g-1]),7===g?$("#tomCoin").text(o[6]):$("#tomCoin").text(o[g]),0===issigned){var h=$(".bg"),p=$(".cat");h.show(),p.show();var f=o[g-1],v=n-f,w=new CountUp("catCoin",v,n);w.start(function(){h.hide(),p.hide()})}$("#progressbar>li:lt("+g+")").addClass("active")}for(var I=$(".coinPrize"),y=0;y<i.length;y++)I.append('<div class="num clearfix" data-id="'+i[y].id+'"><div class="image"><img class="lazy" data-original="'+i[y].img_path[0]+'"></div><div class="prizeInfo"><p class="prizeName">'+i[y].title+'</p><p class="prizeCoin">'+i[y].coin+'金币</p><p class="stock">剩余:'+i[y].stock+'</p><p class="getPrize" data-id="'+i[y].id+'">立即兑换</p></div></div>');$(".num").on("click",function(t){var a=$(this).attr("data-id");window.location.href="/share/index/gift.html?giftId="+a}),$("img.lazy").lazyload()}else alert("网络异常，请稍后再试")}function getTodayPro(){var t=getNowDate(),a=localStorage.getItem("oldDate");t!==a&&(localStorage.setItem("oldDate",t),localStorage.removeItem("proData"));var e=localStorage.getItem("proData");e?cookProData(e):$.ajax({url:"http://haojiazhang123.com/mall/mall_index.json",type:"get",dataType:"json",data:{uid:uid},success:function(t){"success"===t.status&&0!==t.on_sales.length&&cookOnsaleData(t.on_sales)},error:function(t){alert(JSON.stringify(t))}})}function cookOnsaleData(t){for(var a=t.length,e=[],i=$("#productList"),o=0;o<a;o++){var n=t[o],r=n.item.cover_square;r||(r="/static/images/mall/24.png");var s=t[o].item.id;e.push(t[o].end_time);var c,l=t[o].item.improved_ability;l.split("|",2);c=uid?"http://haojiazhang123.com/share/mall_3.0/goodDetail.html?uid="+uid+"&item_id="+s+"&endtime="+encodeURI(n.end_time)+"&tag="+tag:"http://haojiazhang123.com/share/mall_3.0/goodDetail.html?item_id="+s+"&endtime="+encodeURI(n.end_time)+"&tag="+tag,$('<div class="todayProduct"><a href="'+c+'"><div class="productImg"><img class="lazy" src="/static/images/mall/24.png" data-original="'+r+'"><p class="countPanel"><img class="clock" src="/static/images/mall/1.png"><span class="countdown"></span></p><p class="hotBuyer">'+n.read_count+'人在抢</p></div></a><p class="productTitle">'+n.item.title+'</p><p class="productDetail clearfix"><span class="price">¥'+n.item.current_price+'</span><span class="oldPrice">¥'+n.item.original_price+"</span></p></div>").appendTo(i)}$("img.lazy").lazyload(),freshTime(e),timeInterval=setInterval(freshTime,1e3,e)}function getNowDate(){var t=new Date,a=t.getFullYear(),e=t.getMonth()+1,i=t.getDate();return a+""+e+i}function freshTime(t){for(var a=0;a<t.length;a++){var e,i=t[a].replace(/-/gi,"/").replace(/T/gi," "),o=new Date(i),n=new Date,r=parseInt((o.getTime()-n.getTime())/1e3);d=parseInt(r/86400),h=parseInt(r/3600%24)<10?"0"+parseInt(r/3600%24):parseInt(r/3600%24),m=parseInt(r/60%60)<10?"0"+parseInt(r/60%60):parseInt(r/60%60),s=parseInt(r%60)<10?"0"+parseInt(r%60):parseInt(r%60),d>0?$(".countdown:eq("+a+")").text(d+"天"+h+"时"):$(".countdown:eq("+a+")").text(h+":"+m+":"+s),r<=0&&($(" .count_time[id="+a+"]").attr({style:"background:gray"}),$(".coundown:eq("+a+")").text("已抢光"),e="已抢光")}}function makeSnow(){function t(){i.clearRect(0,0,o,n),i.fillStyle="#ffffff",i.fill(),i.beginPath();for(var t=0;t<r;t++){var e=s[t];i.moveTo(e.x,e.y),i.arc(e.x,e.y,e.r,0,2*Math.PI,!0)}a()}function a(){l+=.01;for(var t=0;t<r;t++){var a=s[t];a.y+=Math.cos(l+a.d)+1+a.r/2,a.x+=2*Math.sin(l),(a.x>o+5||a.x<-5||a.y>n)&&(t%3>0?s[t]={x:Math.random()*o,y:-10,r:a.r,d:a.d}:Math.sin(l)>0?s[t]={x:-5,y:Math.random()*n,r:a.r,d:a.d}:s[t]={x:o+5,y:Math.random()*n,r:a.r,d:a.d})}}var e=document.getElementById("canvas"),i=e.getContext("2d"),o=$("#canvas").innerWidth(),n=$("#canvas").innerHeight();e.width=o,e.height=n;for(var r=80,s=[],c=0;c<r;c++)s.push({x:Math.random()*o,y:Math.random()*n,r:2*Math.random()+1,d:Math.random()*r});var l=0;setInterval(t,35)}var timeInterval,startTime,endTime,tag,uid="";$(function(){console.log("text gulp reload");var t=getSearch(),a=t.phoneId;localStorage.setItem("phoneId",a);var e=sessionStorage.getItem("userData"),i=JSON.parse(e);uid=uid||t.uid,tag=t.tag;var o=t.client||"";"IOS"===o.toUpperCase()&&"2.12.5"===t.client_version&&(tag="1"),$(".market").hide(),!o||"Android"!==o&&"IOS"!==o.toUpperCase()||($(".market").show(),getTodayPro()),uid?($(".advance").show(),localStorage.setItem("uid",uid)):($(".login").show(),$(".login").on("click",function(){sessionStorage.removeItem("userData"),login()})),a&&$(".getInvitation").show(),i?cookData(i):ajaxInfo(),$(".activity").on("click",function(){window.location.href="http://www.lewaijiao.com/web/neworder"}),$(".getCoin").on("click",getCoin),$(".myOrder").on("click",showMyOrder),$(".coinRule").on("click",function(){window.location.href="/task/rule.htm"}),$(".intoMarket").on("click",function(){window.location.href="http://haojiazhang123.com/share/mall_3.0/flashSale_3.2.html?uid="+uid+"&tag="+tag}),$(".hotSell").on("click",function(){window.location.href="http://haojiazhang123.com/share/mall_3.0/goodDetail_xxj.html?item_id=1177&uid="+uid+"&tag="+tag}),$(".getInvitation").on("click",function(){uid?window.location.href="http://haojiazhang123.com/share/index/invitation.html?uid="+uid+"&phoneId="+a:(sessionStorage.removeItem("userData"),login())})});